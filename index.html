<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Isolate Functions for Remote Execution • carrier</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Isolate Functions for Remote Execution">
<meta property="og:description" content="Sending functions to remote processes can be wasteful of resources because they carry their environments with them. With the carrier package, it is easy to create functions that are isolated from their environment. These isolated functions, also called crates, print at the console with their total size and can be easily tested locally before being sent to a remote.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">carrier</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/carrier/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">


<div class="section level1">
<div class="page-header"><h1 id="carrier">carrier<a class="anchor" aria-label="anchor" href="#carrier"></a>
</h1></div>
<p>The carrier package provides tools to package up functions so they can be sent to remote R sessions or to different processes, and tools to test your crates locally. They make it easy to control what data should be packaged with the function and what size your crated function is.</p>
<p>Currently, carrier only provides a strict function constructor that forces you to be explicit about the functions and the data your function depends on. In the future it will also provide tools to figure it out automatically.</p>
<p>See also the <a href="https://rstudio.github.io/bundle/" class="external-link">bundle</a> package for the tidymodels ecosystem.</p>
<div class="section level2">
<h2 id="creating-explicit-crated-functions">Creating explicit crated functions<a class="anchor" aria-label="anchor" href="#creating-explicit-crated-functions"></a>
</h2>
<p><code><a href="reference/crate.html">crate()</a></code> is a function constructor that forces you to be explicit about which data should be packaged with the function. You can create functions using the standard R syntax:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;crate&gt; 1.12 kB</span></span>
<span><span class="co">#&gt; * function: 560 B</span></span>
<span><span class="co">#&gt; function (x) </span></span>
<span><span class="co">#&gt; mean(x, na.rm = TRUE)</span></span></code></pre></div>
<p>Or with a purrr-like lambda syntax:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;crate&gt; 1.57 kB</span></span>
<span><span class="co">#&gt; * function: 1.01 kB</span></span>
<span><span class="co">#&gt; function (..., .x = ..1, .y = ..2, . = ..1) </span></span>
<span><span class="co">#&gt; mean(.x, na.rm = TRUE)</span></span></code></pre></div>
<p>The crated function prints with its total size in the header, so you know how much data you will send to remotes. The size of the bare function without any data is also printed in the first bullet, and if you add objects to the crate their size is printed in decreasing order.</p>
<div class="section level3">
<h3 id="explicit-namespaces">Explicit namespaces<a class="anchor" aria-label="anchor" href="#explicit-namespaces"></a>
</h3>
<p><code><a href="reference/crate.html">crate()</a></code> requires you to be explicit about all dependencies of your function. Except for base functions, you have to call functions with their namespace prefix. You can test your function locally to make sure you’ve been explicit enough. In the following example we forgot to specify that <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var()</a></code> comes from the stats namespace:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">fn</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in var(.x): could not find function "var"</span></span></code></pre></div>
<p>So let’s add the namespace prefix:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span><span class="op">~</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">fn</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9.166667</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="explicit-data">Explicit data<a class="anchor" aria-label="anchor" href="#explicit-data"></a>
</h3>
<p>If your function depends on global data, you need to declare it to make it available to your crated function. Here we forgot to declare <code>na_rm</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">na_rm</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="va">na_rm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">fn</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in fn(1:10): object 'na_rm' not found</span></span></code></pre></div>
<p>There are two techniques for packaging data into your crate: passing data as arguments, and unquoting data in the function.</p>
<div class="section level4">
<h4 id="passing-data-as-arguments">Passing data as arguments<a class="anchor" aria-label="anchor" href="#passing-data-as-arguments"></a>
</h4>
<p>You can declare objects by passing them as named arguments to <code><a href="reference/crate.html">crate()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="va">na_rm</span><span class="op">)</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="va">na_rm</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">fn</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9.166667</span></span></code></pre></div>
<p>Note how the size of each imported object is displayed when you print the crated function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span></span>
<span><span class="co">#&gt; &lt;crate&gt; 1.51 kB</span></span>
<span><span class="co">#&gt; * function: 840 B</span></span>
<span><span class="co">#&gt; * `na_rm`: 56 B</span></span>
<span><span class="co">#&gt; function (x) </span></span>
<span><span class="co">#&gt; stats::var(x, na.rm = na_rm)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="unquoting-data-in-the-function">Unquoting data in the function<a class="anchor" aria-label="anchor" href="#unquoting-data-in-the-function"></a>
</h4>
<p>Another way of packaging data is to unquote objects with <code>!!</code>. This works because unquoting inlines objects in function calls. Unquoting can be less verbose if you have many small objects to import inside the function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">na_rm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;crate&gt; 1.40 kB</span></span>
<span><span class="co">#&gt; * function: 840 B</span></span>
<span><span class="co">#&gt; function (x) </span></span>
<span><span class="co">#&gt; stats::var(x, na.rm = TRUE)</span></span></code></pre></div>
<p>However, be careful not to unquote large objects because:</p>
<ul>
<li>The sizes of unquoted objects are not detailed when you print the crate.</li>
<li>Inlined data can cause noisy output.</li>
</ul>
<p>Let’s unquote a data frame to see the noise caused by inlining:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset a few rows so the call is not too noisy</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Inline data in call by unquoting</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crate.html">crate</a></span><span class="op">(</span><span class="op">~</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">.x</span>, data <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This crate will print with noisy inlined data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span></span>
<span><span class="co">#&gt; &lt;crate&gt; 4.65 kB</span></span>
<span><span class="co">#&gt; * function: 4.14 kB</span></span>
<span><span class="co">#&gt; function (..., .x = ..1, .y = ..2, . = ..1) </span></span>
<span><span class="co">#&gt; stats::lm(.x, data = list(mpg = c(21, 21, 22.8, 21.4, 18.7), </span></span>
<span><span class="co">#&gt;     cyl = c(6, 6, 4, 6, 8), disp = c(160, 160, 108, 258, 360), </span></span>
<span><span class="co">#&gt;     hp = c(110, 110, 93, 110, 175), drat = c(3.9, 3.9, 3.85, </span></span>
<span><span class="co">#&gt;     3.08, 3.15), wt = c(2.62, 2.875, 2.32, 3.215, 3.44), qsec = c(16.46, </span></span>
<span><span class="co">#&gt;     17.02, 18.61, 19.44, 17.02), vs = c(0, 0, 1, 1, 0), am = c(1, </span></span>
<span><span class="co">#&gt;     1, 1, 0, 0), gear = c(4, 4, 4, 3, 3), carb = c(4, 4, 1, 1, </span></span>
<span><span class="co">#&gt;     2)))</span></span></code></pre></div>
<p>Same for the function call recorded by <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fn</span><span class="op">(</span><span class="va">disp</span> <span class="op">~</span> <span class="va">drat</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::lm(formula = .x, data = structure(list(mpg = c(21, 21, </span></span>
<span><span class="co">#&gt; 22.8, 21.4, 18.7), cyl = c(6, 6, 4, 6, 8), disp = c(160, 160, </span></span>
<span><span class="co">#&gt; 108, 258, 360), hp = c(110, 110, 93, 110, 175), drat = c(3.9, </span></span>
<span><span class="co">#&gt; 3.9, 3.85, 3.08, 3.15), wt = c(2.62, 2.875, 2.32, 3.215, 3.44</span></span>
<span><span class="co">#&gt; ), qsec = c(16.46, 17.02, 18.61, 19.44, 17.02), vs = c(0, 0, </span></span>
<span><span class="co">#&gt; 1, 1, 0), am = c(1, 1, 1, 0, 0), gear = c(4, 4, 4, 3, 3), carb = c(4, </span></span>
<span><span class="co">#&gt; 4, 1, 1, 2)), row.names = c("Mazda RX4", "Mazda RX4 Wag", "Datsun 710", </span></span>
<span><span class="co">#&gt; "Hornet 4 Drive", "Hornet Sportabout"), class = "data.frame"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)         drat  </span></span>
<span><span class="co">#&gt;       952.3       -207.8</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the carrier project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=carrier" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/r-lib/carrier/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/r-lib/carrier/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing carrier</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Lionel Henry <br><small class="roles"> Author, maintainer </small>   </li>
<li>Posit Software, PBC <br><small class="roles"> Copyright holder, funder </small>  <a href="https://ror.org/03wc8by49" class="external-link"><img src="https://raw.githubusercontent.com/ror-community/ror-logos/main/ror-icon-rgb.svg" class="ror" alt="ROR"></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/r-lib/carrier/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/r-lib/carrier/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Lionel Henry, Posit Software, PBC.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
