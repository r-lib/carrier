<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Crate a function to share with another process — crate • carrier</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Crate a function to share with another process — crate"><meta property="og:description" content="crate() creates functions in a self-contained environment
(technically, a child of the base environment). This has two
advantages:
They can easily be executed in another process.
Their effects are reproducible. You can run them locally with the
same results as on a different process.


Creating self-contained functions requires some care, see section
below."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">carrier</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/r-lib/carrier/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Crate a function to share with another process</h1>
    <small class="dont-index">Source: <a href="https://github.com/r-lib/carrier/blob/v0.3.0/R/crate.R" class="external-link"><code>R/crate.R</code></a></small>
    <div class="hidden name"><code>crate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>crate()</code> creates functions in a self-contained environment
(technically, a child of the base environment). This has two
advantages:</p><ul><li><p>They can easily be executed in another process.</p></li>
<li><p>Their effects are reproducible. You can run them locally with the
same results as on a different process.</p></li>
</ul><p>Creating self-contained functions requires some care, see section
below.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">crate</span><span class="op">(</span></span>
<span>  <span class="va">.fn</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .parent_env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">baseenv</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .error_arg <span class="op">=</span> <span class="st">".fn"</span>,</span>
<span>  .error_call <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg--fn">.fn<a class="anchor" aria-label="anchor" href="#arg--fn"></a></dt>
<dd><p>A fresh formula or function. "Fresh" here means that
they should be declared in the call to <code>crate()</code>. See examples if
you need to crate a function that is already defined. Formulas
are converted to purrr-like lambda functions using
<code><a href="https://rlang.r-lib.org/reference/as_function.html" class="external-link">rlang::as_function()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Named arguments to declare in the environment of <code>.fn</code>.</p></dd>


<dt id="arg--parent-env">.parent_env<a class="anchor" aria-label="anchor" href="#arg--parent-env"></a></dt>
<dd><p>The default of <code><a href="https://rdrr.io/r/base/environment.html" class="external-link">baseenv()</a></code> ensures that the evaluation
environment of the crate is isolated from the search path. Specifying
another environment such as the global environment allows this condition to
be relaxed (but at the expense of no longer being able to rely on a local
run giving the same results as one in a different process).</p></dd>


<dt id="arg--error-arg">.error_arg<a class="anchor" aria-label="anchor" href="#arg--error-arg"></a></dt>
<dd><p>An argument name as a string. This argument
will be mentioned in error messages as the input that is at the
origin of a problem.</p></dd>


<dt id="arg--error-call">.error_call<a class="anchor" aria-label="anchor" href="#arg--error-call"></a></dt>
<dd><p>The execution environment of a currently
running function, e.g. <code>caller_env()</code>. The function will be
mentioned in error messages as the source of the error. See the
<code>call</code> argument of <code><a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">abort()</a></code> for more information.</p></dd>

</dl></div>
    <div id="creating-self-contained-functions">
    <h2>Creating self-contained functions</h2>


<ul><li><p>They should call package functions with an explicit <code>::</code>
namespace. This includes packages in the default search path with
the exception of the base package. For instance <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var()</a></code> from the
stats package must be called with its namespace prefix:
<code>stats::var(x)</code>.</p></li>
<li><p>They should declare any data they depend on. You can declare data
by supplying additional arguments or by unquoting objects with <code>!!</code>.</p></li>
<li><p>A function (closure) supplied as an additional argument is itself crated.
This means that it must be self-contained by supplying all objects required
by it as further additional arguments, if not already supplied. Only
functions directly supplied to <code>...</code> are crated, and containers such as
lists are not recursively walked to find functions. Note that if an
existing crate is supplied, this is not re-crated.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># You can create functions using the ordinary notation:</span></span></span>
<span class="r-in"><span><span class="fu">crate</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;crate&gt; 1.23 kB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * function: 672 B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (x) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stats::var(x)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or the formula notation:</span></span></span>
<span class="r-in"><span><span class="fu">crate</span><span class="op">(</span><span class="op">~</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;crate&gt; 1.68 kB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * function: 1.12 kB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (..., .x = ..1, .y = ..2, . = ..1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stats::var(.x)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Declare data by supplying named arguments. You can test you have</span></span></span>
<span class="r-in"><span><span class="co"># declared all necessary data by calling your crated function:</span></span></span>
<span class="r-in"><span><span class="va">na_rm</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu">crate</span><span class="op">(</span><span class="op">~</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="va">na_rm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">fn</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in fn(1:10) : object 'na_rm' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For small data it is handy to unquote instead. Unquoting inlines</span></span></span>
<span class="r-in"><span><span class="co"># objects inside the function. This is less verbose if your</span></span></span>
<span class="r-in"><span><span class="co"># function depends on many small objects:</span></span></span>
<span class="r-in"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu">crate</span><span class="op">(</span><span class="op">~</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">na_rm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">fn</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 9.166667</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># One downside is that the individual sizes of unquoted objects</span></span></span>
<span class="r-in"><span><span class="co"># won't be shown in the crate printout:</span></span></span>
<span class="r-in"><span><span class="va">fn</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;crate&gt; 1.85 kB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * function: 1.29 kB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (..., .x = ..1, .y = ..2, . = ..1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stats::var(.x, na.rm = TRUE)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The function or formula you pass to crate() should defined inside</span></span></span>
<span class="r-in"><span><span class="co"># the crate() call, i.e. you can't pass an already defined</span></span></span>
<span class="r-in"><span><span class="co"># function:</span></span></span>
<span class="r-in"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">crate</span><span class="op">(</span><span class="va">fn</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in crate(fn) : The function must be defined inside this call</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you really need to crate an existing function, you can</span></span></span>
<span class="r-in"><span><span class="co"># explicitly set its environment to the crate environment with the</span></span></span>
<span class="r-in"><span><span class="co"># set_env() function from rlang:</span></span></span>
<span class="r-in"><span><span class="fu">crate</span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/get_env.html" class="external-link">set_env</a></span><span class="op">(</span><span class="va">fn</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;crate&gt; 952 B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * function: 392 B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (x) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> toupper(x)</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lionel Henry, Posit Software, PBC.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

